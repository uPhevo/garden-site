<!-- flowers/templates/flowers/detail.html -->
<!DOCTYPE html>
<html lang="ru" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ö–æ—Ä–∑–∏–Ω–∞ ‚Äî –°–∫–∞–∑–æ—á–Ω—ã–π —Å–∞–¥</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <style>
    .block {
      min-height: 785px;
      position: relative;
      padding-bottom: 60px;
    } 
    .block::after {
      content: "";
      min-height: 100vh;
      background: url(/static/images/photo_2025-07-31_21-01-57-redefine-realistic-4x.jpeg);
      background-size: cover;
      background-position: center;
      filter: brightness(90%);
      top: 0;
      left: 0;
      bottom: 0;
      right: 0;
      position: absolute;
      z-index: -1;
      border-radius: inherit;
      image-rendering: auto

            /* –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –≤–Ω–∏–∑—É */
      mask-image: linear-gradient(to bottom, black 70%, transparent 100%);
      -webkit-mask-image: linear-gradient(to bottom, black 70%, transparent 100%);
    }

    .fireflies-container {
      position: absolute;
      width: 100%; height: 100%;
      pointer-events: none;
      top: 0; left: 0;
      z-index: 0;
      overflow: hidden;
    }
    .firefly {
      position: absolute;
      width: 8px; height: 8px;
      background: radial-gradient(circle, gold 0%, rgba(255, 215, 0, 0.2) 80%);
      border-radius: 50%;
      box-shadow: 0 0 12px gold;
      opacity: 0.8;
      animation: moveFirefly linear infinite;
    }
    @keyframes moveFirefly {
      0% { transform: translate3d(0,0,0); opacity: 0.6; }
      50% { transform: translate3d(40px,-60px,0); opacity: 1; }
      100% { transform: translate3d(-30px,60px,0); opacity: 0.5; }
    }
  </style>
</head>
<body class="flex flex-col min-h-screen bg-gradient-to-b from-white to-gray-100 text-gray-900 font-sans">

  <div class="flex flex-col min-h-screen">
    <div class="block flex-grow relative">
      <!-- Header -->
      <header class="bg-white bg-opacity-80 h-20 shadow-lg sticky top-0 z-50 backdrop-blur-md">
        <div class="fireflies-container"></div>
        <div class="max-w-7xl mx-auto px-4 h-full flex items-center justify-between relative">
          <div class="absolute -top-2">
            <a href="{% url 'home' %}">
              <img src="/static/images/logo.png" alt="–õ–æ–≥–æ—Ç–∏–ø" class="h-24 sm:h-24 object-contain" />
            </a>
          </div>
          <nav class="ml-auto hidden sm:flex items-center h-full space-x-4 sm:space-x-6 text-sm sm:text-base text-black">
            <a href="{% url 'catalog' %}" class="hover:text-yellow-600">–ö–∞—Ç–∞–ª–æ–≥</a>
            <a href="{% url 'about' %}" class="hover:text-yellow-600">–û –Ω–∞—Å</a>
            <a href="{% url 'contacts' %}" class="hover:text-yellow-600">–°–≤—è–∑—å</a>
            <a href="{% url 'personals' %}" class="flex items-center h-full hover:text-yellow-600 transition">
            –£—Å–ª–æ–≤–∏—è —Ä–∞–±–æ—Ç—ã
            </a>
            <a href="{% url 'cart_view' %}" class="bg-yellow-600 hover:bg-yellow-500 text-white font-semibold text-xs sm:text-sm px-3 sm:px-4 rounded-xl shadow flex items-center h-10">
              üõí –ö–æ—Ä–∑–∏–Ω–∞
            </a>
          </nav>
        </div>
      </header>

      <!-- –í–µ—Ä—Ö–Ω–∏–π –≥—Ä–∞–¥–∏–µ–Ω—Ç -->
      <div class="absolute top-0 left-0 right-0 h-48 bg-gradient-to-b from-yellow-600 to-transparent opacity-80 pointer-events-none"></div>

      <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
      <section class="max-w-3xl mx-auto mt-12 bg-white bg-opacity-90 rounded-3xl shadow-xl p-4 sm:p-6 md:p-8 relative z-10 w-[92%]">
        <h2 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-6 text-center">üõí –í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞</h2>

        {% if items %}
          {% for item in items %}
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 border-b pb-2 text-gray-700">
              <span>{{ item.flower.name }} <span class="text-sm text-gray-500">(x{{ item.quantity }})</span></span>
              <span class="font-semibold mt-1 sm:mt-0">{{ item.subtotal }} ‚ÇΩ</span>
            </div>
          {% endfor %}
          <p class="text-xl font-bold mt-8 text-right text-yellow-700">–ò—Ç–æ–≥–æ: {{ total }} ‚ÇΩ</p>

          <form method="post" action="{% url 'clear_cart' %}" class="mt-6">
            {% csrf_token %}
            <button type="submit" class="bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-lg shadow w-full sm:w-auto">
              üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É
            </button>
          </form>

          <form id="order-form" class="mt-10 space-y-4">
            {% csrf_token %}
            <input type="text" name="name" placeholder="–í–∞—à–µ –∏–º—è" required class="w-full p-3 border border-yellow-300 rounded-xl" />
            <input type="email" name="email" placeholder="Email" required class="w-full p-3 border border-yellow-300 rounded-xl" />
            <input type="text" name="phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" required class="w-full p-3 border border-yellow-300 rounded-xl" />
            <select name="delivery" class="w-full p-3 border border-yellow-300 rounded-xl">
              <option value="cdek">–°–î–≠–ö</option>
              <option value="post">–ü–æ—á—Ç–∞ –†–æ—Å—Å–∏–∏</option>
            </select>
            <button type="submit" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-6 rounded-xl shadow-lg">
              üå∏ –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑
            </button>
          </form>
        {% else %}
          <p class="text-center text-gray-600 text-lg">–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞ üß∫</p>
        {% endif %}

        <div id="order-success-message" class="mt-6 text-green-600 font-semibold text-lg hidden">
          ‚úÖ –ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! –°–ø–∞—Å–∏–±–æ! üòä
        </div>
        <div id="order-error-message" class="mt-6 text-red-600 font-semibold text-lg hidden">
          ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–∫–∞–∑–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.
        </div>
      </section>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-100 py-7 text-center text-gray-500 text-sm">
      &copy; 2025 –°–∫–∞–∑–æ—á–Ω—ã–π —Å–∞–¥.
    </footer>
  </div>

  <script>
    (() => {
      const container = document.querySelector(".fireflies-container");
      for (let i = 0; i < 20; i++) {
        const firefly = document.createElement("div");
        firefly.classList.add("firefly");
        firefly.style.top = `${Math.random() * 100}%`;
        firefly.style.left = `${Math.random() * 100}%`;
        firefly.style.animationDuration = `${5 + Math.random() * 6}s`;
        firefly.style.animationDelay = `${Math.random() * 5}s`;
        container.appendChild(firefly);
      }
    })();

    function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim();
          if (cookie.substring(0, name.length + 1) === (name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }

    document.getElementById('order-form')?.addEventListener('submit', function(e) {
      e.preventDefault();
      const form = e.target;
      const data = new FormData(form);
      fetch("{% url 'submit_order' %}", {
        method: "POST",
        headers: {
          "X-CSRFToken": getCookie("csrftoken")
        },
        body: data
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          document.getElementById('order-success-message').classList.remove('hidden');
          document.getElementById('order-error-message').classList.add('hidden');
          form.reset();
        } else {
          throw new Error(data.error || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞");
        }
      })
      .catch(err => {
        document.getElementById('order-error-message').classList.remove('hidden');
        document.getElementById('order-success-message').classList.add('hidden');
      });
    });
  </script>
</body>
</html>
